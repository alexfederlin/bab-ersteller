{% extends "base.html" %}

{% block content %}
<h2>{{ 'Edit Report' if report else 'Add New Report' }}</h2>
<form method="POST">
    {{ form.hidden_tag() }}

    <div>
        <label for="plane">Plane</label>
        {{ form.plane(class="form-control") }}
    </div>

    <div>
        <label for="date">Date</label>
        {{ form.date(class="form-control") }}
    </div>

    <h3>Tasks</h3>
    <div id="task-container">
        {% for task_form in form.tasks %}
            <div class="task-item">
                <label>Art der Beanstandung / Durchzuf√ºhrende Arbeiten</label>
                {{ task_form.task_description(class="form-control") }}

                <label>Art der Behebung / Durchgef√ºhrte Arbeiten</label>
                {{ task_form.fix_description(class="form-control") }}

                <label>Bezug / Seriennummer</label>
                {{ task_form.reference(class="form-control") }}

                <label>Ausf√ºhrender</label>
                {{ task_form.executor(class="form-control") }}

                <button type="button" class="remove-task">üóëÔ∏è</button>
            </div>
        {% endfor %}
    </div>

    <button type="button" id="add-task">‚ûï Add Task</button>

    <div>
        <button type="submit">{{ 'Update Report' if report else 'Add Report' }}</button>
        <a href="{{ url_for('main.reports') }}" class="btn btn-secondary">Back to Reports List</a>
    </div>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        let taskIndex = {{ form.tasks|length }};
        const taskContainer = document.getElementById('task-container');
        const addTaskButton = document.getElementById('add-task');

        // Add a new task
        addTaskButton.addEventListener('click', function () {
            const newTaskHTML = `
            <div class="task-item">
                <label>Art der Beanstandung / Durchzuf√ºhrende Arbeiten</label>
                <textarea name="tasks-${taskIndex}-task_description" class="form-control"></textarea>

                <label>Art der Behebung / Durchgef√ºhrte Arbeiten</label>
                <textarea name="tasks-${taskIndex}-fix_description" class="form-control"></textarea>

                <label>Bezug / Seriennummer</label>
                <input type="text" name="tasks-${taskIndex}-reference" class="form-control" />

                <label>Ausf√ºhrender</label>
                <input type="text" name="tasks-${taskIndex}-executor" class="form-control" />

                <button type="button" class="remove-task">üóëÔ∏è</button>
            </div>`;
            taskContainer.insertAdjacentHTML('beforeend', newTaskHTML);
            taskIndex++;
        });

        // Remove a task
        taskContainer.addEventListener('click', function (event) {
            if (event.target.classList.contains('remove-task')) {
                event.target.parentElement.remove();
            }
        });
    });
</script>
{% endblock %}
